<Window x:Class="NxDataManager.Views.DatabaseStatusWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="ðŸ“Š æ•°æ®åº“çŠ¶æ€æŸ¥çœ‹" 
        Height="750" Width="1100"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource BackgroundBrush}">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- æ ‡é¢˜æ  -->
        <Border Grid.Row="0" Background="{DynamicResource PrimaryBrush}" Padding="20,15">
            <Grid>
                <StackPanel>
                    <TextBlock Text="ðŸ“Š æ•°æ®åº“çŠ¶æ€æŸ¥çœ‹å™¨" FontSize="20" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="æŸ¥çœ‹å¢žé‡å’Œå·®å¼‚å¤‡ä»½çš„æ–‡ä»¶è®°å½•" FontSize="12" 
                               Foreground="White" Opacity="0.8" Margin="0,4,0,0"/>
                </StackPanel>
                
                <Button Content="ðŸ”„" 
                        Command="{Binding RefreshCommand}"
                        Style="{StaticResource ToolbarIconButtonStyle}"
                        HorizontalAlignment="Right" VerticalAlignment="Center"
                        ToolTip="åˆ·æ–°æ•°æ®"
                        Foreground="White"/>
            </Grid>
        </Border>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <Border Grid.Row="1" Background="{DynamicResource SurfaceBrush}" 
                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1"
                Padding="20,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- ä»»åŠ¡æ€»æ•° -->
                <Border Grid.Column="0" Background="{DynamicResource AccentBrush}" 
                        CornerRadius="8" Padding="16,12" Margin="0,0,8,0">
                    <StackPanel>
                        <TextBlock Text="ðŸ“‹ ä»»åŠ¡æ€»æ•°" FontSize="12" Foreground="White" Opacity="0.9"/>
                        <TextBlock Text="{Binding TotalTasks}" FontSize="28" FontWeight="Bold" 
                                   Foreground="White" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- åŽ†å²è®°å½• -->
                <Border Grid.Column="1" Background="{DynamicResource SuccessBrush}" 
                        CornerRadius="8" Padding="16,12" Margin="0,0,8,0">
                    <StackPanel>
                        <TextBlock Text="ðŸ“œ åŽ†å²è®°å½•" FontSize="12" Foreground="White" Opacity="0.9"/>
                        <TextBlock Text="{Binding TotalHistories}" FontSize="28" FontWeight="Bold" 
                                   Foreground="White" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- æ–‡ä»¶è®°å½• -->
                <Border Grid.Column="2" Background="{DynamicResource WarningBrush}" 
                        CornerRadius="8" Padding="16,12">
                    <StackPanel>
                        <TextBlock Text="ðŸ“„ æ–‡ä»¶è®°å½•" FontSize="12" Foreground="White" Opacity="0.9"/>
                        <TextBlock Text="{Binding TotalFileRecords}" FontSize="28" FontWeight="Bold" 
                                   Foreground="White" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- ä¸»å†…å®¹åŒº -->
        <Grid Grid.Row="2" Margin="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- å·¦ä¾§ï¼šä»»åŠ¡åˆ—è¡¨ -->
            <Border Grid.Column="0" Background="{DynamicResource SurfaceBrush}" 
                    BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"
                    CornerRadius="8" Padding="0" Margin="0,0,16,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="{DynamicResource PrimaryBrush}" 
                            CornerRadius="8,8,0,0" Padding="16,12">
                        <TextBlock Text="ðŸ“‹ å¤‡ä»½ä»»åŠ¡åˆ—è¡¨" FontSize="14" FontWeight="Bold" 
                                   Foreground="White"/>
                    </Border>

                    <ListBox Grid.Row="1" ItemsSource="{Binding Tasks}" 
                             SelectedItem="{Binding SelectedTask}"
                             SelectionChanged="TaskListBox_SelectionChanged"
                             Background="Transparent"
                             BorderThickness="0"
                             Padding="8">
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Padding" Value="12,10"/>
                                <Setter Property="Margin" Value="4,2"/>
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                                <Setter Property="BorderThickness" Value="1"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListBoxItem">
                                            <Border Background="{TemplateBinding Background}"
                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                    CornerRadius="6"
                                                    Padding="{TemplateBinding Padding}">
                                                <ContentPresenter/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="{DynamicResource PrimaryBrush}"/>
                                        <Setter Property="Foreground" Value="White"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="{DynamicResource HoverBrush}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ListBox.ItemContainerStyle>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock Text="{Binding Name}" FontSize="13" FontWeight="SemiBold"/>
                                    <TextBlock FontSize="11" Opacity="0.8" Margin="0,4,0,0">
                                        <Run Text="ç±»åž‹:"/>
                                        <Run Text="{Binding BackupType}"/>
                                    </TextBlock>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>

            <!-- å³ä¾§ï¼šæ–‡ä»¶è®°å½•åˆ—è¡¨ -->
            <Border Grid.Column="1" Background="{DynamicResource SurfaceBrush}" 
                    BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"
                    CornerRadius="8">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="{DynamicResource PrimaryBrush}" 
                            CornerRadius="8,8,0,0" Padding="16,12">
                        <Grid>
                            <TextBlock Text="ðŸ“„ æ–‡ä»¶å¤‡ä»½è®°å½•" FontSize="14" FontWeight="Bold" 
                                       Foreground="White" VerticalAlignment="Center"/>
                            
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <TextBlock Text="æ€»è®¡: " FontSize="12" Foreground="White" 
                                           Opacity="0.8" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding FileRecords.Count}" FontSize="12" 
                                           FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                                <TextBlock Text=" æ¡è®°å½•" FontSize="12" Foreground="White" 
                                           Opacity="0.8" VerticalAlignment="Center" Margin="4,0,0,0"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <DataGrid Grid.Row="1" ItemsSource="{Binding FileRecords}" 
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              GridLinesVisibility="Horizontal"
                              RowHeight="40"
                              HeadersVisibility="Column"
                              Background="Transparent"
                              BorderThickness="0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ç±»åž‹" Binding="{Binding BackupTypeDisplay}" Width="60"/>
                            <DataGridTextColumn Header="æ–‡ä»¶è·¯å¾„" Binding="{Binding RelativePath}" Width="*"/>
                            <DataGridTextColumn Header="å¤§å°" Binding="{Binding FileSizeFormatted}" Width="80"/>
                            <DataGridTextColumn Header="ä¿®æ”¹æ—¶é—´" Binding="{Binding LastModifiedTime, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Width="130"/>
                            <DataGridTextColumn Header="å¤‡ä»½æ—¶é—´" Binding="{Binding BackupTime, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Width="130"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- ç©ºçŠ¶æ€ -->
                    <StackPanel Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Center"
                                Visibility="{Binding FileRecords.Count, Converter={StaticResource ZeroToVisibilityConverter}}">
                        <TextBlock Text="ðŸ“‚" FontSize="64" HorizontalAlignment="Center" Opacity="0.3"/>
                        <TextBlock Text="é€‰æ‹©å·¦ä¾§ä»»åŠ¡æŸ¥çœ‹æ–‡ä»¶è®°å½•" FontSize="14" 
                                   Foreground="{DynamicResource TextSecondaryBrush}" 
                                   HorizontalAlignment="Center" Margin="0,12,0,0"/>
                    </StackPanel>

                    <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
                    <Border Grid.Row="1" Background="{DynamicResource SurfaceBrush}" 
                            Opacity="0.9"
                            Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <ProgressBar Width="200" Height="4" IsIndeterminate="True"/>
                            <TextBlock Text="æ­£åœ¨åŠ è½½..." FontSize="14" 
                                       Foreground="{DynamicResource TextSecondaryBrush}" 
                                       HorizontalAlignment="Center" Margin="0,12,0,0"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- åº•éƒ¨çŠ¶æ€æ  -->
        <Border Grid.Row="3" Background="{DynamicResource SurfaceBrush}" 
                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,1,0,0"
                Padding="20,12">
            <Grid>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="ðŸ’¡ " FontSize="14" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding StatusMessage}" 
                               Foreground="{DynamicResource TextSecondaryBrush}" 
                               VerticalAlignment="Center" FontSize="13"/>
                </StackPanel>

                <Button Content="âœ– å…³é—­" 
                        Command="{Binding CloseCommand}"
                        Style="{StaticResource PrimaryButton}" 
                        Padding="24,10"
                        HorizontalAlignment="Right"/>
            </Grid>
        </Border>
    </Grid>
</Window>
