<Window x:Class="NxDataManager.Views.TaskEditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:NxDataManager"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}" 
        Height="700" Width="800"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource BackgroundBrush}"
        ResizeMode="CanResize">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- æ ‡é¢˜æ  -->
        <Border Grid.Row="0" Background="{DynamicResource PrimaryBrush}" Padding="20,15">
            <Grid>
                <StackPanel>
                    <TextBlock Text="{Binding CurrentTask.Name, FallbackValue='æ–°å»ºä»»åŠ¡'}" 
                               FontSize="20" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="é…ç½®å¤‡ä»½ä»»åŠ¡çš„è¯¦ç»†å‚æ•°" 
                               FontSize="12" Foreground="White" Opacity="0.8" Margin="0,4,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ä¸»å†…å®¹åŒº -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="20">
            <StackPanel>
                <!-- åŸºæœ¬ä¿¡æ¯ -->
                <Border Background="{DynamicResource SurfaceBrush}" 
                        BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"
                        CornerRadius="8" Padding="20" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="ðŸ“ åŸºæœ¬ä¿¡æ¯" FontSize="16" FontWeight="Bold" 
                                   Foreground="{DynamicResource TextPrimaryBrush}" Margin="0,0,0,16"/>
                        
                        <TextBlock Text="ä»»åŠ¡åç§°" Margin="0,0,0,6" FontSize="13"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                        <TextBox Text="{Binding CurrentTask.Name, UpdateSourceTrigger=PropertyChanged}"
                                 FontSize="14" Padding="12,10"/>

                        <TextBlock Text="æºè·¯å¾„ï¼ˆè¦å¤‡ä»½çš„æ–‡ä»¶å¤¹ï¼‰" Margin="0,16,0,6" FontSize="13"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Text="{Binding CurrentTask.SourcePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     FontSize="14" Padding="12,10"/>
                            <Button Grid.Column="1" Content="ðŸ“ æµè§ˆ..." Margin="8,0,0,0" 
                                    Padding="16,10" Style="{DynamicResource PrimaryButton}"
                                    Command="{Binding BrowseSourcePathCommand}"/>
                        </Grid>

                        <TextBlock Text="ç›®æ ‡è·¯å¾„ï¼ˆå¤‡ä»½å­˜å‚¨ä½ç½®ï¼‰" Margin="0,16,0,6" FontSize="13"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Text="{Binding CurrentTask.DestinationPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     FontSize="14" Padding="12,10"/>
                            <Button Grid.Column="1" Content="ðŸ“ æµè§ˆ..." Margin="8,0,0,0" 
                                    Padding="16,10" Style="{DynamicResource PrimaryButton}"
                                    Command="{Binding BrowseDestinationPathCommand}"/>
                        </Grid>

                        <TextBlock Text="å¤‡ä»½ç±»åž‹" Margin="0,16,0,6" FontSize="13"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                        <ComboBox SelectedItem="{Binding CurrentTask.BackupType}" FontSize="14" Padding="12,10">
                            <ComboBox.ItemsSource>
                                <x:Array Type="local:BackupType" 
                                         xmlns:local="clr-namespace:NxDataManager.Models">
                                    <local:BackupType>Full</local:BackupType>
                                    <local:BackupType>Incremental</local:BackupType>
                                    <local:BackupType>Differential</local:BackupType>
                                </x:Array>
                            </ComboBox.ItemsSource>
                        </ComboBox>

                        <CheckBox Content="âœ… å¯ç”¨æ­¤ä»»åŠ¡" IsChecked="{Binding CurrentTask.IsEnabled}" 
                                  Margin="0,20,0,0" FontSize="14" FontWeight="SemiBold"/>
                    </StackPanel>
                </Border>

                <!-- é«˜çº§åŠŸèƒ½ -->
                <Border Background="{DynamicResource SurfaceBrush}" 
                        BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"
                        CornerRadius="8" Padding="20" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="ðŸ”§ é«˜çº§åŠŸèƒ½" FontSize="16" FontWeight="Bold" 
                                   Foreground="{DynamicResource TextPrimaryBrush}" Margin="0,0,0,16"/>
                        
                        <!-- åŽ‹ç¼© -->
                        <CheckBox Content="ðŸ—œï¸ å¯ç”¨åŽ‹ç¼©" IsChecked="{Binding CurrentTask.EnableCompression}" 
                                  Margin="0,0,0,12" FontSize="13"/>
                        <StackPanel Margin="28,0,0,16" IsEnabled="{Binding CurrentTask.EnableCompression}">
                            <TextBlock Text="åŽ‹ç¼©çº§åˆ«" FontSize="12" Margin="0,0,0,6"
                                       Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <ComboBox SelectedItem="{Binding CurrentTask.CompressionLevel}" FontSize="13" Padding="10,8">
                                <ComboBox.ItemsSource>
                                    <x:Array Type="local:CompressionLevel" 
                                             xmlns:local="clr-namespace:NxDataManager.Services">
                                        <local:CompressionLevel>None</local:CompressionLevel>
                                        <local:CompressionLevel>Fast</local:CompressionLevel>
                                        <local:CompressionLevel>Normal</local:CompressionLevel>
                                        <local:CompressionLevel>Maximum</local:CompressionLevel>
                                    </x:Array>
                                </ComboBox.ItemsSource>
                            </ComboBox>
                        </StackPanel>

                        <!-- åŠ å¯† -->
                        <CheckBox Content="ðŸ” å¯ç”¨åŠ å¯† (AES-256)" IsChecked="{Binding CurrentTask.EnableEncryption}" 
                                  Margin="0,0,0,12" FontSize="13"/>
                        <StackPanel Margin="28,0,0,16" IsEnabled="{Binding CurrentTask.EnableEncryption}">
                            <TextBlock Text="åŠ å¯†å¯†ç " FontSize="12" Margin="0,0,0,6"
                                       Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <PasswordBox x:Name="EncryptionPasswordBox" 
                                         FontSize="13" Padding="10,8"
                                         PasswordChanged="EncryptionPasswordBox_PasswordChanged"/>
                            <TextBlock Text="âš ï¸ è¯·åŠ¡å¿…è®°ä½å¯†ç ï¼Œä¸¢å¤±åŽæ— æ³•æ¢å¤æ•°æ®" 
                                       FontSize="11" Foreground="{DynamicResource WarningBrush}" 
                                       Margin="0,6,0,0"/>
                        </StackPanel>

                        <!-- ç‰ˆæœ¬æŽ§åˆ¶ -->
                        <CheckBox Content="ðŸ“ å¯ç”¨ç‰ˆæœ¬æŽ§åˆ¶" IsChecked="{Binding CurrentTask.EnableVersionControl}" 
                                  Margin="0,0,0,12" FontSize="13"/>
                        <StackPanel Margin="28,0,0,16" IsEnabled="{Binding CurrentTask.EnableVersionControl}">
                            <TextBlock Text="ä¿ç•™ç‰ˆæœ¬æ•°" FontSize="12" Margin="0,0,0,6"
                                       Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBox Text="{Binding CurrentTask.KeepVersionCount}" FontSize="13" Padding="10,8" Width="150" HorizontalAlignment="Left"/>
                        </StackPanel>

                        <!-- å¸¦å®½é™åˆ¶ -->
                        <CheckBox Content="âš¡ å¯ç”¨å¸¦å®½é™åˆ¶" IsChecked="{Binding CurrentTask.EnableBandwidthLimit}" 
                                  Margin="0,0,0,12" FontSize="13"/>
                        <StackPanel Margin="28,0,0,16" IsEnabled="{Binding CurrentTask.EnableBandwidthLimit}">
                            <TextBlock Text="é™é€Ÿ (MB/s)" FontSize="12" Margin="0,0,0,6"
                                       Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBox Text="{Binding CurrentTask.BandwidthLimitMBps}" FontSize="13" Padding="10,8" Width="150" HorizontalAlignment="Left"/>
                        </StackPanel>

                        <!-- æ–­ç‚¹ç»­ä¼  -->
                        <CheckBox Content="ðŸ”„ å¯ç”¨æ–­ç‚¹ç»­ä¼ " IsChecked="{Binding CurrentTask.EnableResumable}" 
                                  Margin="0,0,0,0" FontSize="13"/>
                    </StackPanel>
                </Border>

                <!-- è®¡åˆ’ä»»åŠ¡ -->
                <Border Background="{DynamicResource SurfaceBrush}" 
                        BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"
                        CornerRadius="8" Padding="20">
                    <StackPanel>
                        <TextBlock Text="â° è®¡åˆ’ä»»åŠ¡" FontSize="16" FontWeight="Bold" 
                                   Foreground="{DynamicResource TextPrimaryBrush}" Margin="0,0,0,16"/>
                        
                        <TextBlock Text="è®¡åˆ’ç±»åž‹" Margin="0,0,0,6" FontSize="13"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                        <ComboBox SelectedItem="{Binding CurrentTask.Schedule.Type}" 
                                  FontSize="14" Padding="12,10" Margin="0,0,0,16"
                                  SelectionChanged="ScheduleTypeComboBox_SelectionChanged">
                            <ComboBox.ItemsSource>
                                <x:Array Type="local:ScheduleType" 
                                         xmlns:local="clr-namespace:NxDataManager.Models">
                                    <local:ScheduleType>Manual</local:ScheduleType>
                                    <local:ScheduleType>Daily</local:ScheduleType>
                                    <local:ScheduleType>Weekly</local:ScheduleType>
                                    <local:ScheduleType>Monthly</local:ScheduleType>
                                    <local:ScheduleType>Interval</local:ScheduleType>
                                </x:Array>
                            </ComboBox.ItemsSource>
                        </ComboBox>

                        <!-- æ¯å¤©è®¡åˆ’é…ç½® -->
                        <StackPanel x:Name="DailySchedulePanel" 
                                    Visibility="Collapsed"
                                    Margin="0,0,0,12">
                            <TextBlock Text="ðŸ“… æ‰§è¡Œæ—¶é—´" FontSize="13" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,0,8"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="æ¯å¤© " VerticalAlignment="Center" FontSize="13"/>
                                <TextBox Grid.Column="1" x:Name="DailyHourTextBox" Width="50" Margin="8,0" 
                                         Padding="8,6" FontSize="13" HorizontalContentAlignment="Center"
                                         MaxLength="2" Text="00"/>
                                <TextBlock Grid.Column="2" Text=" : " VerticalAlignment="Center" FontSize="13"/>
                                <TextBox Grid.Column="3" x:Name="DailyMinuteTextBox" Width="50" Margin="0,0,8,0" 
                                         Padding="8,6" FontSize="13" HorizontalContentAlignment="Center"
                                         MaxLength="2" Text="00"/>
                                <Button Grid.Column="4" Content="çŽ°åœ¨" Padding="12,6" Margin="8,0,0,0"
                                        Style="{StaticResource PrimaryButton}"
                                        Click="SetCurrentTime_Click"
                                        ToolTip="è®¾ç½®ä¸ºå½“å‰æ—¶é—´"/>
                                <TextBlock Grid.Column="5" Text="  (24å°æ—¶åˆ¶)" VerticalAlignment="Center" 
                                           FontSize="11" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            </Grid>
                        </StackPanel>

                        <!-- æ¯å‘¨è®¡åˆ’é…ç½® -->
                        <StackPanel x:Name="WeeklySchedulePanel" 
                                    Visibility="Collapsed"
                                    Margin="0,0,0,12">
                            <TextBlock Text="ðŸ“… æ˜ŸæœŸé€‰æ‹©" FontSize="13" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,0,8"/>
                            <WrapPanel>
                                <CheckBox x:Name="WeeklyMonday" Content="å‘¨ä¸€" Margin="0,0,12,8" FontSize="12"/>
                                <CheckBox x:Name="WeeklyTuesday" Content="å‘¨äºŒ" Margin="0,0,12,8" FontSize="12"/>
                                <CheckBox x:Name="WeeklyWednesday" Content="å‘¨ä¸‰" Margin="0,0,12,8" FontSize="12"/>
                                <CheckBox x:Name="WeeklyThursday" Content="å‘¨å››" Margin="0,0,12,8" FontSize="12"/>
                                <CheckBox x:Name="WeeklyFriday" Content="å‘¨äº”" Margin="0,0,12,8" FontSize="12"/>
                                <CheckBox x:Name="WeeklySaturday" Content="å‘¨å…­" Margin="0,0,12,8" FontSize="12"/>
                                <CheckBox x:Name="WeeklySunday" Content="å‘¨æ—¥" Margin="0,0,12,8" FontSize="12"/>
                            </WrapPanel>
                            <TextBlock Text="â° æ‰§è¡Œæ—¶é—´" FontSize="13" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,8,0,8"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Grid.Column="0" x:Name="WeeklyHourTextBox" Width="50" Margin="0,0,8,0" 
                                         Padding="8,6" FontSize="13" HorizontalContentAlignment="Center"
                                         MaxLength="2" Text="00"/>
                                <TextBlock Grid.Column="1" Text=" : " VerticalAlignment="Center" FontSize="13"/>
                                <TextBox Grid.Column="2" x:Name="WeeklyMinuteTextBox" Width="50" Margin="8,0" 
                                         Padding="8,6" FontSize="13" HorizontalContentAlignment="Center"
                                         MaxLength="2" Text="00"/>
                                <Button Grid.Column="3" Content="çŽ°åœ¨" Padding="12,6" Margin="8,0,0,0"
                                        Style="{StaticResource PrimaryButton}"
                                        Click="SetCurrentTimeWeekly_Click"
                                        ToolTip="è®¾ç½®ä¸ºå½“å‰æ—¶é—´"/>
                            </Grid>
                        </StackPanel>

                        <!-- æ¯æœˆè®¡åˆ’é…ç½® -->
                        <StackPanel x:Name="MonthlySchedulePanel" 
                                    Visibility="Collapsed"
                                    Margin="0,0,0,12">
                            <TextBlock Text="ðŸ“† æ‰§è¡Œæ—¥æœŸ" FontSize="13" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,0,8"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="æ¯æœˆç¬¬ " VerticalAlignment="Center" FontSize="13"/>
                                <TextBox Grid.Column="1" Text="{Binding CurrentTask.Schedule.DayOfMonth}" 
                                         Width="60" Margin="8,0" Padding="10,8" FontSize="13" HorizontalContentAlignment="Center"
                                         MaxLength="2"/>
                                <TextBlock Grid.Column="2" Text=" å¤© (1-31)" VerticalAlignment="Center" FontSize="13"/>
                            </Grid>
                            <TextBlock Text="â° æ‰§è¡Œæ—¶é—´" FontSize="13" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,12,0,8"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Grid.Column="0" x:Name="MonthlyHourTextBox" Width="50" Margin="0,0,8,0" 
                                         Padding="8,6" FontSize="13" HorizontalContentAlignment="Center"
                                         MaxLength="2" Text="00"/>
                                <TextBlock Grid.Column="1" Text=" : " VerticalAlignment="Center" FontSize="13"/>
                                <TextBox Grid.Column="2" x:Name="MonthlyMinuteTextBox" Width="50" Margin="8,0" 
                                         Padding="8,6" FontSize="13" HorizontalContentAlignment="Center"
                                         MaxLength="2" Text="00"/>
                                <Button Grid.Column="3" Content="çŽ°åœ¨" Padding="12,6" Margin="8,0,0,0"
                                        Style="{StaticResource PrimaryButton}"
                                        Click="SetCurrentTimeMonthly_Click"
                                        ToolTip="è®¾ç½®ä¸ºå½“å‰æ—¶é—´"/>
                            </Grid>
                        </StackPanel>

                        <!-- é—´éš”æ—¶é—´é…ç½® -->
                        <StackPanel x:Name="IntervalSchedulePanel" 
                                    Visibility="Collapsed"
                                    Margin="0,0,0,12">
                            <TextBlock Text="â±ï¸ é—´éš”æ—¶é—´" FontSize="13" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,0,8"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="æ¯ " VerticalAlignment="Center" FontSize="13"/>
                                <TextBox Grid.Column="1" Text="{Binding CurrentTask.Schedule.IntervalHours}" 
                                         Width="80" Margin="8,0" Padding="10,8" FontSize="13" HorizontalContentAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text=" å°æ—¶æ‰§è¡Œä¸€æ¬¡" VerticalAlignment="Center" FontSize="13"/>
                            </Grid>
                        </StackPanel>

                        <!-- ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´é¢„è§ˆ -->
                        <Border Background="{DynamicResource BackgroundBrush}" 
                                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"
                                CornerRadius="6" Padding="16,12" Margin="0,8,0,0">
                            <StackPanel>
                                <TextBlock Text="ðŸ“… ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´" FontSize="12" FontWeight="SemiBold"
                                           Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,0,6"/>
                                <TextBlock Text="{Binding CurrentTask.NextRunTime, StringFormat='{}{0:yyyy-MM-dd HH:mm:ss}', FallbackValue='æ‰‹åŠ¨æ‰§è¡Œ'}" 
                                           FontSize="14" FontWeight="Bold"
                                           Foreground="{DynamicResource PrimaryBrush}"/>
                            </StackPanel>
                        </Border>

                        <CheckBox Content="ðŸ”„ å¾ªçŽ¯æ‰§è¡Œ" IsChecked="{Binding CurrentTask.Schedule.IsRecurring}" 
                                  Margin="0,16,0,0" FontSize="13"/>

                        <TextBlock Text="ðŸ’¡ æç¤ºï¼šå¯ç”¨ä»»åŠ¡åŽï¼Œç³»ç»Ÿå°†æ ¹æ®è®¡åˆ’è‡ªåŠ¨æ‰§è¡Œå¤‡ä»½" 
                                   FontSize="11" Foreground="{DynamicResource TextSecondaryBrush}" 
                                   Margin="0,12,0,0" TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- åº•éƒ¨æŒ‰é’®æ  -->
        <Border Grid.Row="2" Background="{DynamicResource SurfaceBrush}" 
                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,1,0,0"
                Padding="20,16">
            <Grid>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                    <Button Content="ðŸ—‘ï¸ åˆ é™¤ä»»åŠ¡" 
                            Command="{Binding DeleteCommand}"
                            Style="{DynamicResource PrimaryButton}" 
                            Padding="20,12" Margin="0,0,8,0"
                            Background="{DynamicResource ErrorBrush}"
                            ToolTip="åˆ é™¤æ­¤å¤‡ä»½ä»»åŠ¡"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="âŒ å–æ¶ˆ" 
                            Click="CancelButton_Click"
                            Style="{DynamicResource PrimaryButton}" 
                            Padding="24,12" Margin="0,0,12,0"
                            ToolTip="å–æ¶ˆç¼–è¾‘"/>
                    
                    <Button Content="ðŸ’¾ ä¿å­˜ä»»åŠ¡" 
                            Command="{Binding SaveCommand}"
                            Style="{DynamicResource PrimaryButton}" 
                            Padding="28,12"
                            IsEnabled="{Binding IsSaving, Converter={StaticResource InverseBoolConverter}}"
                            ToolTip="ä¿å­˜ä»»åŠ¡é…ç½®"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
