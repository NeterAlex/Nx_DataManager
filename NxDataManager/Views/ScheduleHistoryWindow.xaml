<Window x:Class="NxDataManager.Views.ScheduleHistoryWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="â° è®¡åˆ’ä»»åŠ¡æ‰§è¡ŒåŽ†å²" 
        Height="700" Width="1000"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource BackgroundBrush}">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- æ ‡é¢˜æ  -->
        <Border Grid.Row="0" Background="{DynamicResource PrimaryGradientBrush}" Padding="20,4">
            <Grid>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="&#xE823;" FontFamily="{StaticResource FluentIcons}"
                               FontSize="24" Foreground="White" VerticalAlignment="Center" Margin="0,0,12,0"/>
                    <TextBlock Text="è®¡åˆ’ä»»åŠ¡æ‰§è¡ŒåŽ†å²" FontSize="18" FontWeight="SemiBold" 
                               Foreground="White" VerticalAlignment="Center"/>
                </StackPanel>
                
                <Button Content="&#xE72C;" FontFamily="{StaticResource FluentIcons}"
                        Command="{Binding RefreshCommand}"
                        Style="{StaticResource ToolbarIconButtonStyle}"
                        HorizontalAlignment="Right" VerticalAlignment="Center"
                        ToolTip="åˆ·æ–°æ•°æ®"
                        Foreground="White" Margin="4,0" Padding="12,8" FontSize="16"/>
            </Grid>
        </Border>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <Border Grid.Row="1" Background="{DynamicResource SurfaceBrush}" 
                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1"
                Padding="20,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- æ‰§è¡Œæ€»æ•° -->
                <Border Grid.Column="0" Background="{DynamicResource AccentBrush}" 
                        CornerRadius="8" Padding="16,12" Margin="0,0,8,0">
                    <StackPanel>
                        <TextBlock Text="ðŸ“Š æ‰§è¡Œæ€»æ•°" FontSize="12" Foreground="White" Opacity="0.9"/>
                        <TextBlock Text="{Binding TotalExecutions}" FontSize="28" FontWeight="Bold" 
                                   Foreground="White" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- æˆåŠŸæ¬¡æ•° -->
                <Border Grid.Column="1" Background="{DynamicResource SuccessBrush}" 
                        CornerRadius="8" Padding="16,12" Margin="0,0,8,0">
                    <StackPanel>
                        <TextBlock Text="âœ… æˆåŠŸ" FontSize="12" Foreground="White" Opacity="0.9"/>
                        <TextBlock Text="{Binding SuccessfulExecutions}" FontSize="28" FontWeight="Bold" 
                                   Foreground="White" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- å¤±è´¥æ¬¡æ•° -->
                <Border Grid.Column="2" Background="{DynamicResource ErrorBrush}" 
                        CornerRadius="8" Padding="16,12" Margin="0,0,8,0">
                    <StackPanel>
                        <TextBlock Text="âŒ å¤±è´¥" FontSize="12" Foreground="White" Opacity="0.9"/>
                        <TextBlock Text="{Binding FailedExecutions}" FontSize="28" FontWeight="Bold" 
                                   Foreground="White" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- æˆåŠŸçŽ‡ -->
                <Border Grid.Column="3" Background="{DynamicResource WarningBrush}" 
                        CornerRadius="8" Padding="16,12">
                    <StackPanel>
                        <TextBlock Text="ðŸ“ˆ æˆåŠŸçŽ‡" FontSize="12" Foreground="White" Opacity="0.9"/>
                        <TextBlock Text="{Binding SuccessRate, StringFormat='{}{0:F1}%'}" FontSize="28" FontWeight="Bold" 
                                   Foreground="White" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- æ‰§è¡ŒåŽ†å²åˆ—è¡¨ -->
        <Border Grid.Row="2" Background="{DynamicResource SurfaceBrush}" 
                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"
                CornerRadius="8" Margin="20">
            <Grid>
                <DataGrid ItemsSource="{Binding Histories}" 
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          GridLinesVisibility="Horizontal"
                          RowHeight="45"
                          HeadersVisibility="Column"
                          Background="Transparent"
                          BorderThickness="0">
                    <DataGrid.Columns>
                        <DataGridTemplateColumn Header="çŠ¶æ€" Width="60">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding IsSuccess, Converter={StaticResource BoolToTextConverter}, ConverterParameter='âœ…;âŒ'}" 
                                               FontSize="20" HorizontalAlignment="Center"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="ä»»åŠ¡åç§°" Binding="{Binding TaskName}" Width="200">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="æ‰§è¡Œæ—¶é—´" Binding="{Binding ExecutionTime, StringFormat='{}{0:yyyy-MM-dd HH:mm:ss}'}" Width="150"/>
                        <DataGridTextColumn Header="è®¡åˆ’ç±»åž‹" Binding="{Binding ScheduleType}" Width="100"/>
                        <DataGridTextColumn Header="æ–‡ä»¶æ•°" Width="100">
                            <DataGridTextColumn.Binding>
                                <MultiBinding StringFormat="{}{0}/{1}">
                                    <Binding Path="ProcessedFiles"/>
                                    <Binding Path="TotalFiles"/>
                                </MultiBinding>
                            </DataGridTextColumn.Binding>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="è€—æ—¶" Binding="{Binding Duration, StringFormat='{}{0:hh\\:mm\\:ss}'}" Width="100"/>
                        <DataGridTextColumn Header="é”™è¯¯ä¿¡æ¯" Binding="{Binding ErrorMessage}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- ç©ºçŠ¶æ€ -->
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                            Visibility="{Binding Histories.Count, Converter={StaticResource ZeroToVisibilityConverter}}">
                    <TextBlock Text="â°" FontSize="64" HorizontalAlignment="Center" Opacity="0.3"/>
                    <TextBlock Text="æš‚æ— è®¡åˆ’ä»»åŠ¡æ‰§è¡Œè®°å½•" FontSize="16" FontWeight="Bold"
                               Foreground="{DynamicResource TextSecondaryBrush}" 
                               HorizontalAlignment="Center" Margin="0,12,0,0"/>
                    <TextBlock Text="å¯ç”¨è®¡åˆ’ä»»åŠ¡åŽï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è®°å½•æ‰§è¡Œæƒ…å†µ" FontSize="13"
                               Foreground="{DynamicResource TextSecondaryBrush}" 
                               HorizontalAlignment="Center" Margin="0,8,0,0"/>
                </StackPanel>

                <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
                <Border Background="{DynamicResource SurfaceBrush}" 
                        Opacity="0.95"
                        Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                        <ProgressBar Width="200" Height="4" IsIndeterminate="True"/>
                        <TextBlock Text="æ­£åœ¨åŠ è½½..." FontSize="14" 
                                   Foreground="{DynamicResource TextSecondaryBrush}" 
                                   HorizontalAlignment="Center" Margin="0,12,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- åº•éƒ¨çŠ¶æ€æ  -->
        <Border Grid.Row="3" Background="{DynamicResource SurfaceBrush}" 
                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,1,0,0"
                Padding="20,12">
            <Grid>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="ðŸ’¡ " FontSize="14" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding StatusMessage}" 
                               Foreground="{DynamicResource TextSecondaryBrush}" 
                               VerticalAlignment="Center" FontSize="13"/>
                </StackPanel>

                <Button Content="âœ– å…³é—­" 
                        Command="{Binding CloseCommand}"
                        Style="{StaticResource PrimaryButton}" 
                        Padding="24,10"
                        HorizontalAlignment="Right"/>
            </Grid>
        </Border>
    </Grid>
</Window>
